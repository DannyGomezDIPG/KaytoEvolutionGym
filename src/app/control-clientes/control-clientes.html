<div class="container">
  <mat-card>
    <div class="header-row" style="display: flex; justify-content: space-between; padding: 15px;">
      <mat-card-title>Control de Clientes</mat-card-title>
      <button mat-raised-button color="primary" (click)="abrirFormulario()">
        <mat-icon>person_add</mat-icon> Nuevo Socio
      </button>
    </div>

    <mat-card-content>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Buscar por nombre o correo...</mat-label>
        <input matInput [ngModel]="filtro()" (ngModelChange)="filtro.set($event)" placeholder="Ej. Juan">
      </mat-form-field>

      <table mat-table [dataSource]="clientesEnTabla()" class="mat-elevation-z8 full-width">
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef>Nombre Completo</th>
          <td mat-cell *matCellDef="let cliente">
            {{ cliente.nombre }} {{ cliente.apellidoPaterno }} {{ cliente.apellidoMaterno }}
          </td>
        </ng-container>

        <ng-container matColumnDef="telefono">
          <th mat-header-cell *matHeaderCellDef>Teléfono</th>
          <td mat-cell *matCellDef="let cliente">{{ cliente.telefono || 'N/A' }}</td>
        </ng-container>

        <ng-container matColumnDef="estado">
          <th mat-header-cell *matHeaderCellDef>Estado</th>
          <td mat-cell *matCellDef="let cliente">
            <span [ngClass]="cliente.estado === 'Activo' ? 'status-active' : 'status-inactive'">
              {{ cliente.estado }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let cliente">
            <button mat-icon-button (click)="abrirFormulario(cliente)" title="Editar">
              <mat-icon color="primary">edit</mat-icon>
            </button>
            <button mat-icon-button (click)="abrirAsignarMembresia(cliente)" title="Membresía">
              <mat-icon color="accent">card_membership</mat-icon>
            </button>
            <button mat-icon-button (click)="eliminarSocio(cliente.idSocios)" title="Eliminar">
              <mat-icon color="warn">delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="columnas"></tr>
        <tr mat-row *matRowDef="let row; columns: columnas;"></tr>
      </table>
    </mat-card-content>
  </mat-card>

  <mat-card *ngIf="mostrarFormularioSocio()" class="mt-3">
    <mat-card-title>{{ socioForm().idSocios ? 'Editar Detalle' : 'Registro' }} de Socio</mat-card-title>
    <mat-card-content>
      <div class="form-grid">
        <mat-form-field appearance="outline">
          <mat-label>Nombre</mat-label>
          <input matInput [(ngModel)]="socioForm().nombre">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Apellido Paterno</mat-label>
          <input matInput [(ngModel)]="socioForm().apellidoPaterno">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Apellido Materno</mat-label>
          <input matInput [(ngModel)]="socioForm().apellidoMaterno">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Teléfono</mat-label>
          <input matInput [(ngModel)]="socioForm().telefono">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Correo Electrónico</mat-label>
          <input matInput [(ngModel)]="socioForm().correo" type="email">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Estado</mat-label>
          <mat-select [(ngModel)]="socioForm().estado">
            <mat-option value="Activo">Activo</mat-option>
            <mat-option value="Inactivo">Inactivo</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Notas adicionales</mat-label>
          <textarea matInput [(ngModel)]="socioForm().notas"></textarea>
        </mat-form-field>
      </div>

      <div class="actions">
        <button mat-raised-button color="primary" (click)="guardarSocio()">Guardar Cambios</button>
        <button mat-button (click)="mostrarFormularioSocio.set(false)">Cerrar</button>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card *ngIf="mostrarAsignarMembresia()" class="mt-3 card-membresia">
    <mat-card-title>Asignar Membresía</mat-card-title>
    <mat-card-content>
      <div *ngIf="clienteSeleccionado() as cliente">
        <p><strong>Socio:</strong> {{ cliente.nombre }} {{ cliente.apellidoPaterno }}</p>
        <p><strong>ID:</strong> #{{ cliente.idSocios }}</p>
        
        </div>
      
      <button mat-button color="warn" (click)="mostrarAsignarMembresia.set(false)">Cancelar</button>
    </mat-card-content>
  </mat-card>
</div>